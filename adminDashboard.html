<?php

include('Db_connection.php');

// Stock update in products table
$category = 'Cookies';
$sql = "
    UPDATE tbl_product_id p
    JOIN (
        SELECT v.product_ID, SUM(CAST(o.productStock AS UNSIGNED)) AS totalStock
        FROM tbl_variation_option_id o
        JOIN tbl_product_variation_id v ON o.productVariation_ID = v.productVariation_ID
        GROUP BY v.product_ID
    ) AS stockSum ON p.product_ID = stockSum.product_ID
    SET p.productStock = stockSum.totalStock
";
mysqli_query($conn, $sql);
?>


<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <link rel="stylesheet" href="adminDashboard.css">

  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.3/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/2.3.0/css/dataTables.bootstrap5.css">

  <!-- Sweetalert2 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

  <!-- Chart -->
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body>
  <label>
    <!-- NAVIGATION EXPAND -->
    <input type="checkbox">
    <div class="toggle">
      <span class="topLine common"></span>
      <span class="middleLine common"></span>
      <span class="bottomLine common"></span>
    </div>

    <!-- TOP NAVBAR -->
    <div class="topNav">
      <p>Admin DashBoard</p>
    </div>

    <!-- SIDE NAVBAR -->
    <nav class="sideBar">
      <p>Menu</p>

      <div>
        <ul>
          <li class="dashboardNav nav-link">
            <a href="#dashboardSection">
              <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 32 32" viewBox="0 0 32 32"
                id="Dashboard">
                <path fill="#f24584" d="M29,20v5H3v-5C3,12.83,8.83,7,16,7S29,12.83,29,20z" class="color45aaf2 svgShape">
                </path>
                <path fill="#2e222f"
                  d="M15.5 12h1c.2761 0 .5-.2239.5-.5v-1c0-.2761-.2239-.5-.5-.5h-1c-.2761 0-.5.2239-.5.5v1C15 11.7761 15.2239 12 15.5 12zM7.8682 14.2823l.707.707c.1953.1953.5118.1953.7071 0l.707-.707c.1953-.1953.1953-.5118 0-.7071l-.707-.707c-.1953-.1953-.5118-.1953-.7071 0l-.707.707C7.6729 13.7704 7.6729 14.087 7.8682 14.2823zM22.0108 14.2823l.707.707c.1953.1953.5118.1953.7071 0l.707-.707c.1953-.1953.1953-.5118 0-.7071l-.707-.707c-.1953-.1953-.5118-.1953-.7071 0l-.707.707C21.8155 13.7704 21.8155 14.087 22.0108 14.2823zM24.5 22h1c.2761 0 .5-.2239.5-.5v-1c0-.2761-.2239-.5-.5-.5h-1c-.2761 0-.5.2239-.5.5v1C24 21.7761 24.2239 22 24.5 22zM6.5 22h1C7.7761 22 8 21.7761 8 21.5v-1C8 20.2239 7.7761 20 7.5 20h-1C6.2239 20 6 20.2239 6 20.5v1C6 21.7761 6.2239 22 6.5 22z"
                  class="color3867d6 svgShape"></path>
                <path fill="#ff69a0" d="M21,25H11c0-2.76,2.24-5,5-5S21,22.24,21,25z" class="colord1d8e0 svgShape">
                </path>
                <path fill="#2e222f"
                  d="M16,6C8.2803,6,2,12.2803,2,20v5c0,0.5527,0.4473,1,1,1h26c0.5527,0,1-0.4473,1-1v-5C30,12.2803,23.7197,6,16,6z M12.142,24c0.4471-1.7205,1.9993-3,3.858-3s3.4109,1.2795,3.858,3H12.142z M28,24h-6.0903c-0.4233-2.5071-2.4025-4.4864-4.9097-4.9097V14.5c0-0.2761-0.2239-0.5-0.5-0.5h-1c-0.2761,0-0.5,0.2239-0.5,0.5v4.5903c-2.5071,0.4233-4.4864,2.4025-4.9097,4.9097H4l0-3.649C4,14.1058,8.6262,8.6393,14.844,8.0545C21.9786,7.3834,28,13.0013,28,20V24z"
                  class="color3867d6 svgShape"></path>
              </svg>
              <span>Dashboard</span>
            </a>
          </li>

          <li class="ordersNav nav-link">
            <a href="#orderSection">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="receipt">
                <defs>
                  <linearGradient id="a" x1="19.475" x2="4.525" y1="23.474" y2="8.525" gradientUnits="userSpaceOnUse">
                    <stop offset="0" stop-color="#ff609a" class="stopColor60efff svgShape"></stop>
                    <stop offset=".117" stop-color="#f15f95" class="stopColor5ff0f1 svgShape"></stop>
                    <stop offset=".503" stop-color="#f55d95" class="stopColor5df5ca svgShape"></stop>
                    <stop offset=".811" stop-color="#ff69a0" class="stopColor5cf8b1 svgShape"></stop>
                    <stop offset="1" stop-color="#fa5c96" class="stopColor5cfaa9 svgShape"></stop>
                  </linearGradient>
                </defs>
                <g fill="#000000" class="color000000 svgShape">
                  <path fill="url(#a)"
                    d="M23,16c0,1.2-.12,2.29-.29,3.25-.3,1.68-1.66,2.96-3.35,3.21-2.16,.32-4.63,.54-7.36,.54s-5.2-.22-7.36-.54c-1.69-.25-3.05-1.53-3.35-3.21-.17-.96-.29-2.05-.29-3.25s.12-2.29,.29-3.25c.18-1.01,.7401-1.87,1.52-2.45l1.19,1.08v.01l5.31,4.82c1.52,1.39,3.86,1.39,5.38,0l5.31-4.82v-.01l1.19-1.08c.78,.58,1.34,1.44,1.52,2.45,.17,.96,.29,2.05,.29,3.25Z">
                  </path>
                </g>
                <g fill="#000000" class="color000000 svgShape">
                  <g fill="#000000" class="color000000 svgShape">
                    <path fill="#2e222f"
                      d="M23.6943,12.5747c-.2188-1.2319-.8965-2.3247-1.9043-3.0752-.2518-.1885-.517-.3453-.79-.4798V3c0-1.6543-1.3457-3-3-3H6c-1.6543,0-3,1.3457-3,3v6.0197c-.2726,.1342-.537,.2905-.7871,.4779-1.0107,.7524-1.6885,1.8452-1.9072,3.0781-.2031,1.1445-.3057,2.2969-.3057,3.4243s.1025,2.2798,.3057,3.4258c.373,2.0908,2.0557,3.708,4.1875,4.0234,2.4688,.3652,4.9941,.5508,7.5068,.5508s5.0381-.1855,7.5068-.5508c2.1318-.3154,3.8145-1.9326,4.1875-4.0249,.2031-1.1445,.3057-2.2969,.3057-3.4243s-.1025-2.2798-.3057-3.4253ZM6,2h12c.5518,0,1,.4487,1,1v7.9399l-4.9844,4.5322c-1.1299,1.0332-2.9014,1.0322-4.0332-.002l-4.9824-4.5303V3c0-.5513,.4482-1,1-1Zm15.7256,17.0742c-.2217,1.2441-1.2314,2.207-2.5117,2.3965-4.7441,.7021-9.6836,.7021-14.4277,0-1.2803-.1895-2.29-1.1523-2.5117-2.395-.1816-1.0298-.2744-2.0645-.2744-3.0757s.0928-2.0459,.2744-3.0747c.082-.4605,.2834-.8813,.5647-1.2471l5.7957,5.2696c.9443,.8633,2.1553,1.2944,3.3662,1.2944,1.21,0,2.4199-.4312,3.3623-1.2925l5.7979-5.2717c.2808,.3655,.4823,.7861,.5644,1.2463,.1816,1.0298,.2744,2.0645,.2744,3.0757s-.0928,2.0459-.2744,3.0742Z"
                      class="color212529 svgShape"></path>
                    <path fill="#2e222f"
                      d="M12.5,10h-2.5c-.5527,0-1,.4478-1,1s.4473,1,1,1h1c0,.5522,.4473,1,1,1s1-.4478,1-1v-.0506c1.14-.2323,2-1.2422,2-2.4494,0-1.3784-1.1211-2.5-2.5-2.5h-1c-.2754,0-.5-.2241-.5-.5s.2246-.5,.5-.5h2.5c.5527,0,1-.4478,1-1s-.4473-1-1-1h-1c0-.5522-.4473-1-1-1s-1,.4478-1,1v.0506c-1.14,.2323-2,1.2422-2,2.4494,0,1.3784,1.1211,2.5,2.5,2.5h1c.2754,0,.5,.2241,.5,.5s-.2246,.5-.5,.5Z"
                      class="color212529 svgShape"></path>
                  </g>
                </g>
              </svg>
              <span>Orders</span>
            </a>
          </li>

          <li class="inventoryNav nav-link">
            <a href="#inventorySection">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 128 128" id="DeliveryBox">
                <path fill="#ff69a0" stroke="#2e222f" stroke-linecap="round" stroke-linejoin="round" stroke-width="5"
                  d="M102 52.4232L102 75.5222C102 77.976 100.715 80.2506 98.6136 81.5174L84 90.3258L67.747 100.626C65.4593 102.075 62.5407 102.075 60.2531 100.626L44 90.3258L29.3864 81.5174C27.2848 80.2507 26 77.976 26 75.5222L26 52.4232C26 49.999 27.2543 47.7473 29.3155 46.4713L45 36.7619L60.3155 27.2809C62.5731 25.8833 65.4269 25.8833 67.6845 27.2809L83 36.7619L98.6845 46.4713C100.746 47.7473 102 49.999 102 52.4232Z"
                  class="colorffd84e svgShape colorStroke000000 svgStroke"></path>
                <path stroke="#2e222f" stroke-linecap="round" stroke-linejoin="round" stroke-width="5"
                  d="M101 50L64 73.0746M64 73.0746L64 102M64 73.0746L44.5 61.5373L27 50"
                  class="colorStroke000000 svgStroke"></path>
                <path stroke="#2e222f" stroke-linecap="round" stroke-width="5"
                  d="M45.5 62L83.5 37M36 64L12 64M39 71L18 71M37 78L10 78" class="colorStroke000000 svgStroke"></path>
              </svg>
              <span>Inventory</span>
            </a>
          </li>

          <li class="accountNav nav-link">
            <a href="#accountSection">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" id="Users">
                <path fill="#ff69a0"
                  d="M17.05 51.49a1 1 0 0 1-.4-.94c.33-2.74 2.49-14.11 15.21-14.67s15.25 11.68 15.67 14.63a1 1 0 0 1-.45 1c-2.84 1.79-16.68 9.64-30.03-.02Z"
                  class="color666666 svgShape"></path>
                <path fill="#2e222f"
                  d="M32 32.83a9.52 9.52 0 0 1-9.56-9.57A9.57 9.57 0 1 1 32 32.83Zm0-16.13a6.43 6.43 0 0 0-4.08 1.42 6.58 6.58 0 0 0 1.51 11.19 6.69 6.69 0 0 0 5.3-.07 6.57 6.57 0 0 0 1.65-10.86A6.5 6.5 0 0 0 32 16.7Z"
                  class="color0a1c1b svgShape"></path>
                <path fill="#2e222f"
                  d="M40.74 34.17a9.63 9.63 0 0 1-6.39-2.44 1.49 1.49 0 0 1 .37-2.48 6.58 6.58 0 0 0 1.66-10.87 1.5 1.5 0 0 1 .38-2.48 9.57 9.57 0 1 1 4 18.27zm-2.63-3.55A6.56 6.56 0 1 0 40.74 18h-.71a9.57 9.57 0 0 1-1.92 12.55zM32 57.7h-1.81c-.41 0-.85-.07-1.29-.13a4.6 4.6 0 0 1-.6-.07l-.7-.1-.6-.2c-.38-.08-.71-.15-1-.24s-.72-.17-1.11-.29l-.89-.25c-.32-.1-.63-.21-.95-.34a23.66 23.66 0 0 1-3.82-1.79L18.8 54l-.21-.13a25.73 25.73 0 0 1-2.46-1.71 1.52 1.52 0 0 1-.57-1.05v-.5A16.42 16.42 0 0 1 32 34.19a16.45 16.45 0 0 1 16.45 16.46v.5a1.52 1.52 0 0 1-.57 1.05c-.27.21-.54.42-.81.61l-.39.27c-.14.11-.32.23-.49.34s-.59.39-.9.57-.59.35-.88.51a24.852 24.852 0 0 1-2.93 1.39l-.85.32-.88.3-.67.2-.72.19-.74.19c-.83.18-1.66.32-2.46.42l-1 .1a6.71 6.71 0 0 1-.67 0h-.8zm.47-3zm-13.92-4.43c.52.38 1.05.74 1.59 1.07l.23.14.36.21a20.28 20.28 0 0 0 3.4 1.59c.3.12.54.2.8.28a7.63 7.63 0 0 0 .73.23c.33.1.65.19 1 .26s.58.14.84.2l.68.12.62.1.43.05a11.44 11.44 0 0 0 1.19.11 7.59 7.59 0 0 0 .79 0 7.59 7.59 0 0 0 .8 0h1.94c.32 0 .58 0 .84-.09a21.74 21.74 0 0 0 2.21-.4c.22 0 .43-.1.64-.16l.6-.15.63-.19.77-.26.78-.3c.29-.11.53-.22.77-.33.63-.28 1.21-.56 1.77-.87l.8-.47c.25-.15.51-.31.75-.48l.37-.24.09-.07.31-.22.18-.13a13.41 13.41 0 0 0-7.56-11.73 13.46 13.46 0 0 0-19.35 11.73zm28.39.73z"
                  class="color0a1c1b svgShape"></path>
                <path fill="#2e222f"
                  d="M46.94 52.52a1.5 1.5 0 0 1-1.49-1.63v-.24a13.42 13.42 0 0 0-7.56-12.11 1.5 1.5 0 0 1 .44-2.83 17.53 17.53 0 0 1 2.41-.17 16.45 16.45 0 0 1 13.69 7.33 1.49 1.49 0 0 1 .07 1.55 25.9 25.9 0 0 1-6.63 7.78 1.52 1.52 0 0 1-.93.32zm-3.49-13.71a16.32 16.32 0 0 1 4.77 9 23 23 0 0 0 3.18-4.07 13.48 13.48 0 0 0-7.95-4.93zM23.82 34a9.57 9.57 0 1 1 3.74-18.38 1.5 1.5 0 0 1 .36 2.56 6.5 6.5 0 0 0-2.48 5.13 6.57 6.57 0 0 0 4 6 1.5 1.5 0 0 1 .35 2.55A9.53 9.53 0 0 1 23.82 34zm0-16.13a6.57 6.57 0 1 0 0 13.13 6.4 6.4 0 0 0 2.06-.33 9.6 9.6 0 0 1-1.75-12.8zm-6.76 34.65a1.52 1.52 0 0 1-.93-.32 25.6 25.6 0 0 1-6.42-7.41 1.5 1.5 0 0 1 0-1.52 16.36 16.36 0 0 1 14.09-8 17.19 17.19 0 0 1 2.35.16 1.5 1.5 0 0 1 .41 2.86 13.49 13.49 0 0 0-8 12.32v.24a1.5 1.5 0 0 1-1.49 1.63zm-4.28-8.44a23.2 23.2 0 0 0 3 3.79 16.5 16.5 0 0 1 4.94-9.21 13.36 13.36 0 0 0-7.94 5.42z"
                  class="color0a1c1b svgShape"></path>
                <path fill="#2e222f"
                  d="M32 57.7h-1.81c-.41 0-.85-.07-1.29-.13a4.6 4.6 0 0 1-.6-.07l-.7-.1-.6-.2c-.38-.08-.71-.15-1-.24s-.72-.17-1.11-.29l-.89-.25c-.32-.1-.63-.21-.95-.34a23.66 23.66 0 0 1-3.82-1.79L18.8 54l-.21-.13a25.72 25.72 0 1 1 29.28-1.67c-.27.21-.54.42-.81.61l-.39.27c-.14.11-.32.23-.49.34s-.59.39-.9.57-.59.35-.88.51a24.852 24.852 0 0 1-2.93 1.39c-.32.12-.44.17-.7.27l-.15.05-.88.3-.67.2-.72.19-.74.19c-.83.18-1.66.32-2.46.42l-1 .1a6.71 6.71 0 0 1-.67 0h-.8Zm.47-3ZM32 9.3a22.68 22.68 0 0 0-14 40.54 23.85 23.85 0 0 0 2.16 1.5l.23.14.36.21a20.28 20.28 0 0 0 3.4 1.59c.3.12.54.2.8.28a7.63 7.63 0 0 0 .73.23c.33.1.65.19 1 .26s.58.14.84.2l.68.12.62.1.43.05a11.44 11.44 0 0 0 1.19.11 7.59 7.59 0 0 0 .79 0 7.59 7.59 0 0 0 .8 0h1.94c.32 0 .58 0 .84-.09a21.74 21.74 0 0 0 2.19-.4c.22 0 .43-.1.64-.16l.6-.15.63-.19.77-.26.13-.05.63-.24c.31-.12.55-.23.79-.34.63-.28 1.21-.56 1.77-.87l.8-.47c.25-.15.51-.31.75-.48l.37-.24.09-.07.31-.22c.28-.2.51-.38.74-.56A22.69 22.69 0 0 0 32 9.3Z"
                  class="color0a1c1b svgShape"></path>
              </svg>
              <span>Accounts</span>
            </a>
          </li>
        </ul>
      </div>
      <div class="userAccountNavigationSection">
            <img src="images/userIcon.png" id="userPopUp" alt="User Icon">
        </div>
      <div class="accountDropDown">
      <p class="welcomeUser">Welcome!</p>
      <div class="logOutSection">
        <a href="logout.php?logout">Log Out</a>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" id="logout">
          <path fill="#ff69a0" fill-rule="evenodd" d="M3 13H15V11H3V13Z" clip-rule="evenodd" class="color90caea svgShape"></path>
          <path fill="#ff69a0" fill-rule="evenodd" d="M5.79282 7.79291L2.29282 11.2929C1.90229 11.6834 1.90229 12.3166 2.29282 12.7071L5.79282 16.2071L7.20703 14.7929L4.41414 12L7.20703 9.20712L5.79282 7.79291Z" clip-rule="evenodd" class="color90caea svgShape"></path>
          <path fill="#2e222f" fill-rule="evenodd" d="M8 4C8 3.44772 8.44772 3 9 3H21C21.5523 3 22 3.44772 22 4V20C22 20.5523 21.5523 21 21 21H9C8.44772 21 8 20.5523 8 20V17H10V19H20V5H10V7H8V4Z" clip-rule="evenodd" class="color3747d6 svgShape"></path>
        </svg>
      </div>
    </div>
        
      <img class="logoSideNav" src="images/bannerLogo.png" alt="ByteSize Logo">
    </nav>
  </label>

  <!-- for main content checkerts and charts -->
  <div class="mainContent">

  <!-- <div id="chartContainer" style="width: 600px; height: 600px;">
            <canvas id="productStockChart"></canvas>
            </div> -->

    <section id="dashboardSection" class="Page-Section">
      
  <div id="chartContainer" style="width: 600px; height: 600px;">
            <canvas id="productStockChart"></canvas>
            </div>

             <script>
    // Fetch data from PHP
    fetch('get_products.php')
      .then(response => response.json())
      .then(data => {
        // Example: Use productCategory as label, productStock as value
        const labels = data.map(row => row.productCategory);
        const stocks = data.map(row => Number(row.productStock));

        const ctx = document.getElementById('productStockChart').getContext('2d');
        new Chart(ctx, {
          type: 'pie',
          data: {
            labels: labels,
            datasets: [{
              label: 'Product Stock',
              data: stocks,
              backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
              ],
              borderColor: [
                'rgba(255,99,132,1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
              ],
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
      });
    </script>
    
    </section>
    

    <section id="orderSection" class="Page-Section">
      <h1>Tapusin</h1>
    </section>

    <!-- Inventory Section -->
    <section id="inventorySection" class="Page-Section">

      <div class="ProductForm-Container mb-4 p-3 bg-white rounded shadow-sm">
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#productModal">Add
          Product</button>

        <div class="table-responsive" style="max-height: calc(100vh - 150px); overflow-y: auto;">
          <table class="table table-bordered table-striped table-hover" id="productTable">
            <thead class="table-dark text-center">
              <tr>
                <th>Product ID</th>
                <th>Product Category</th>
                <th>Stock</th>
                <th>Update</th>
                <th>Delete</th>
              </tr>
            </thead>
            <tbody class="text-center align-middle">
              <?php
              $query = "SELECT * FROM `tbl_product_id`";
              $result = mysqli_query($conn, $query);
              if ($result) {
                while ($row = mysqli_fetch_assoc($result)) {
                  ?>
                  <tr>
                    <td><?= $row['product_ID']; ?></td>
                    <td><?= $row['productCategory']; ?></td>
                    <!-- <td><?= $row['productName']; ?></td> -->

                    <!-- <td><?= 'Php ' . number_format($row['productPrice'], 2); ?></td> -->
                    <td><?= $row['productStock']; ?></td>
                    <!-- <td>
                      <img src="<?= $row['productImage']; ?>" alt="Product Image"
                        style="max-width: 80px; height: auto; border-radius: 5px;">
                    </td> -->
                    <td><a href="#" class="btn btn-success updateBtn" data-id="<?= $row['product_ID']; ?>">Update</a></td>
                    <td><a href="#" class="btn btn-danger deleteBtn" data-id="<?= $row['product_ID']; ?>">Delete</a></td>
                    <?php
                }
              }
              ?>
            </tbody>
          </table>
        </div>
      </div>


      <div class="variation-Container mb-4 p-3 bg-white rounded shadow-sm">
        <!-- Button to open modal -->
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#variationModal">
          Add Variation
        </button>

        <div class="table-responsive" style="max-height: calc(100vh - 150px); overflow-y: auto;">
          <table class="table table-bordered table-striped table-hover" id="variationTable">
            <thead class="table-dark text-center">
              <tr>
                <th>Product ID</th>
                <th>Variation Name</th>
                <th>Image</th>
                <th>Date Created</th>
                <th>Date Updated</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody class="text-center align-middle">
              <!-- Rows will be added here -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Variation Option -->
      <div class="option-Container mb-4 p-3 bg-white rounded shadow-sm">

        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#optionModal">
          Add Option
        </button>

        <div class="table-responsive" style="max-height: calc(100vh - 150px); overflow-y: auto;">
          <table class="table table-bordered table-striped table-hover" id="optionTable">
            <thead class="table-dark text-center">
              <tr>
                <th>Option ID</th>
                <th>Variation ID</th>
                <th>Option Name</th>
                <th>Stock</th>
                <th>Price</th>
                <th>Date Created</th>
                <th>Date Updated</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody class="text-center align-middle">
              <!-- DataTables will fill this -->
            </tbody>
          </table>
        </div>
      </div>



      <!-- Update Modal Products -->
      <div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <form id="updateForm" method="post" enctype="multipart/form-data" action="update_product.php">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Update Product</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <input type="hidden" name="product_ID" id="edit_product_ID">

                <div class="mb-3">
                  <label for="edit_productCategory" class="form-label">Product Category</label>
                  <input type="text" class="form-control" name="productCategory" id="edit_productCategory">
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" name="update_product" class="btn btn-primary">Update</button>
              </div>
            </div>
          </form>
        </div>
      </div>


    </section>


    <section id="accountSection" class="Page-Section">


      <div class="Account-Container">



        <!-- Button to open modal -->
        <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addAdminModal">Add Admin</button>
        <div class="tableAdmin">
          <div class="table-responsive" style="max-height: calc(100vh - 150px); overflow-y: auto;">
            <table id="adminTable" class="table table-bordered table-striped table-hover">
              <thead>
                <tr>
                  <th>User ID</th>
                  <th>Full Name</th>
                  <th>Email</th>
                  <th>Contact Number</th>
                  <th>Gender</th>
                  <th>User Role</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Login Activity -->
        <div class="LoginAct">

          <div class="table-responsive" style="max-height: calc(100vh - 150px); overflow-y: auto;">
            <table id="loginTable" class="table table-bordered table-striped table-hover">
              <thead>
                <tr>
                  <th>login_ID</th>
                  <th>user_ID</th>
                  <th>Email</th>
                  <th>Role</th>
                  <th>Login Time</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

    </section>

  </div> <!--main content end-->



  <!-- Modal for adding variation -->
  <div class="modal fade" id="variationModal" tabindex="-1" aria-labelledby="variationModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <form id="variationForm" enctype="multipart/form-data">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="variationModalLabel">Add Variation</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="product_ID" class="form-label">Product</label>
              <select class="form-control" name="product_ID" id="product_ID" required>
                <option value="">Select Product</option>
                <?php
                $productQuery = "SELECT product_ID, productCategory FROM tbl_product_id";
                $productResult = mysqli_query($conn, $productQuery);
                if ($productResult) {
                  while ($prod = mysqli_fetch_assoc($productResult)) {
                    echo '<option value="' . $prod['product_ID'] . '">' . $prod['product_ID'] . ' - ' . htmlspecialchars($prod['productCategory']) . '</option>';
                  }
                }
                ?>
              </select>
            </div>
            <div class="mb-3">
              <label for="variation_Name" class="form-label">Variation Name</label>
              <input type="text" class="form-control" name="variation_Name" id="variation_Name" required>
            </div>
            <div class="mb-3">
              <label for="product_Image" class="form-label">Variation Image (optional)</label>
              <input type="file" class="form-control" name="product_Image" id="product_Image">
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Add Variation</button>
          </div>
        </div>
      </form>
    </div>
  </div>



  <!-- update modal variation -->
  <div class="modal fade" id="updateVariationModal" tabindex="-1" aria-labelledby="updateVariationModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
      <form id="updateVariationForm" enctype="multipart/form-data">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="updateVariationModalLabel">Update Variation</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" name="productVariation_ID" id="edit_productVariation_ID">
            <div class="mb-3">
              <label for="edit_variation_Name" class="form-label">Variation Name</label>
              <input type="text" class="form-control" name="variation_Name" id="edit_variation_Name" required>
            </div>
            <div class="mb-3">
              <label for="edit_product_Image" class="form-label">Variation Image (optional)</label>
              <input type="file" class="form-control" name="product_Image" id="edit_product_Image">
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Update Variation</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Add Option Modal -->
  <div class="modal fade" id="optionModal" tabindex="-1" aria-labelledby="optionModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <form id="optionForm">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="optionModalLabel">Add Variation Option</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="productVariation_ID" class="form-label">Variation</label>
              <select class="form-control" name="productVariation_ID" id="productVariation_ID" required>
                <option value="">Select Variation</option>
                <?php
                $varQuery = "SELECT productVariation_ID, variation_Name FROM tbl_product_variation_id";
                $varResult = mysqli_query($conn, $varQuery);
                if ($varResult) {
                  while ($var = mysqli_fetch_assoc($varResult)) {
                    echo '<option value="' . $var['productVariation_ID'] . '">' . $var['productVariation_ID'] . ' - ' . htmlspecialchars($var['variation_Name']) . '</option>';
                  }
                }
                ?>
              </select>
            </div>
            <div class="mb-3">
              <label for="productOption" class="form-label">Option Name</label>
              <input type="text" class="form-control" name="productOption" id="productOption" required>
            </div>
            <div class="mb-3">
              <label for="productStock" class="form-label">Stock</label>
              <input type="text" class="form-control" name="productStock" id="productStock" required>
            </div>
            <div class="mb-3">
              <label for="productPrice" class="form-label">Price</label>
              <input type="text" class="form-control" name="productPrice" id="productPrice" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Add Option</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- update modal option variation  -->
  <div class="modal fade" id="updateOptionModal" tabindex="-1" aria-labelledby="updateOptionModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
      <form id="updateOptionForm">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="updateOptionModalLabel">Update Option</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" name="option_ID" id="edit_option_ID">
            <div class="mb-3">
              <label for="edit_productOption" class="form-label">Option Name</label>
              <input type="text" class="form-control" name="productOption" id="edit_productOption" required>
            </div>
            <div class="mb-3">
              <label for="edit_productStock" class="form-label">Stock</label>
              <input type="text" class="form-control" name="productStock" id="edit_productStock" required>
            </div>
            <div class="mb-3">
              <label for="edit_productPrice" class="form-label">Price</label>
              <input type="text" class="form-control" name="productPrice" id="edit_productPrice" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Update Option</button>
          </div>
        </div>
      </form>
    </div>
  </div>




  <!-- Add Admin Modal -->
  <div class="modal fade" id="addAdminModal" tabindex="-1" aria-labelledby="addAdminModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <form id="addAdminForm">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addAdminModalLabel">Add Admin</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="firstName" class="form-label">First Name</label>
              <input type="text" class="form-control" name="firstName" id="firstName" required>
            </div>
            <div class="mb-3">
              <label for="lastName" class="form-label">Last Name</label>
              <input type="text" class="form-control" name="lastName" id="lastName" required>
            </div>
            <div class="mb-3">
              <label for="emailAddress" class="form-label">Email</label>
              <input type="email" class="form-control" name="emailAddress" id="emailAddress" required>
            </div>
            <div class="mb-3">
              <label for="contactNumber" class="form-label">Contact Number</label>
              <input type="number" class="form-control" name="contactNumber" id="contactNumber" maxlength="11" required>
            </div>
            <div class="mb-3">
              <label for="gender" class="form-label">Gender</label>
              <select class="form-control" name="gender" id="gender" required>
                <option value="">Select</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="Password" class="form-label">Password</label>
              <input type="password" class="form-control" name="Password" id="Password" required>
            </div>
            <div class="mb-3">
              <label for="ConfirmPass" class="form-label">Confirm Password</label>
              <input type="password" class="form-control" name="ConfirmPass" id="ConfirmPass" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Add Admin</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Update Admin Modal -->
  <div class="modal fade" id="updateAdminModal" tabindex="-1" aria-labelledby="updateAdminModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
      <form id="updateAdminForm">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="updateAdminModalLabel">Update Admin</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" name="user_ID" id="edit_user_ID">
            <div class="mb-3">
              <label for="edit_firstName" class="form-label">First Name</label>
              <input type="text" class="form-control" name="firstName" id="edit_firstName" required>
            </div>
            <div class="mb-3">
              <label for="edit_lastName" class="form-label">Last Name</label>
              <input type="text" class="form-control" name="lastName" id="edit_lastName" required>
            </div>
            <div class="mb-3">
              <label for="edit_emailAddress" class="form-label">Email</label>
              <input type="email" class="form-control" name="emailAddress" id="edit_emailAddress" required>
            </div>
            <div class="mb-3">
              <label for="edit_contactNumber" class="form-label">Contact Number</label>
              <input type="text" class="form-control" name="contactNumber" id="edit_contactNumber" required>
            </div>
            <div class="mb-3">
              <label for="edit_gender" class="form-label">Gender</label>
              <select class="form-control" name="gender" id="edit_gender" required>
                <option value="">Select</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="edit_userRole" class="form-label">User Role</label>
              <input type="text" class="form-control" name="userRole" id="edit_userRole" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Update Admin</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- add product modal -->
  <div class="modal fade" id="productModal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <form method="POST" enctype="multipart/form-data" action="add_Product.php" id="productForm">
        <!-- Add action="your_handler.php" if needed -->
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="productModalLabel">Add New Product</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <div class="modal-body">
            <!-- Product Category -->
            <label for="productCategory" name="productCategory">Product Category: </label>
            <input type="text" name="productCategory" id="productCategory" class="form-control">
            <span class="error-msg text-danger" id="productCategoryError"></span>

            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-primary">Save Product</button>
            </div>
          </div>
      </form>
    </div>
  </div>



  <!-- sweetalert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- scripts -->
  <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>

  <script src="https://cdn.datatables.net/2.3.0/js/dataTables.js"></script>
  <script src="https://cdn.datatables.net/2.3.0/js/dataTables.bootstrap5.js"></script>
  <script>

    document.addEventListener("DOMContentLoaded", () => {
      const links = document.querySelectorAll(".nav-link a");
      const sections = document.querySelectorAll("section");

      // Hide all sections initially
      sections.forEach(section => section.style.display = "none");

      // Show dashboard by default
      const defaultSection = document.querySelector("#dashboardSection");
      if (defaultSection) defaultSection.style.display = "block";

      links.forEach(link => {
        link.addEventListener("click", function (e) {
          // e.preventDefault();

          // Hide all sections
          sections.forEach(section => section.style.display = "none");

          // Get the target section from href
          const targetId = this.getAttribute("href").substring(1);
          const targetSection = document.getElementById(targetId);

          // Show the selected section
          if (targetSection) targetSection.style.display = "block";
        });
      });
    });


    // for admin creation DataTables
    $('#adminTable').DataTable({
      ajax: 'fetch_admins.php',
      columns: [
        { data: 'user_ID' },
        { data: 'fullName' },
        { data: 'emailAddress' },
        { data: 'contactNumber' },
        { data: 'gender' },
        { data: 'userRole' },
        { data: 'actions', orderable: false, searchable: false }
      ]
    });
    $('#addAdminForm').on('submit', function (e) {
      e.preventDefault();
      $.ajax({
        url: 'add_admin.php',
        type: 'POST',
        data: $(this).serialize(),
        dataType: 'json',
        success: function (res) {
          $('#addAdminModal').modal('hide');
          $('#addAdminForm')[0].reset();
          $('#adminTable').DataTable().ajax.reload();
          Swal.fire({
            icon: res.success ? 'success' : 'error',
            title: res.success ? 'Success' : 'Error',
            text: res.message,
            timer: 1500,
            showConfirmButton: false
          });
        }
      });
    });

    // Show update modal and fill with data
    $('#adminTable').on('click', '.updateAdminBtn', function () {
      var userId = $(this).data('user-id');
      $.ajax({
        url: 'get_admin.php',
        type: 'POST',
        data: { user_ID: userId },
        dataType: 'json',
        success: function (data) {
          $('#edit_user_ID').val(data.user_ID);
          $('#edit_firstName').val(data.firstName);
          $('#edit_lastName').val(data.lastName);
          $('#edit_emailAddress').val(data.emailAddress);
          $('#edit_contactNumber').val(data.contactNumber);
          $('#edit_gender').val(data.gender);
          $('#edit_userRole').val(data.userRole);
          $('#updateAdminModal').modal('show');
        }
      });
    });

    $('#updateAdminForm').on('submit', function (e) {
      e.preventDefault();
      $.ajax({
        url: 'update_admin.php',
        type: 'POST',
        data: $(this).serialize(),
        dataType: 'json',
        success: function (res) {
          $('#updateAdminModal').modal('hide');
          $('#adminTable').DataTable().ajax.reload();
          Swal.fire({
            icon: res.success ? 'success' : 'error',
            title: res.success ? 'Success' : 'Error',
            text: res.message,
            timer: 1500,
            showConfirmButton: false
          });
        }
      });
    });
    // Delete admin
    $('#adminTable').on('click', '.deleteAdminBtn', function () {
      var adminId = $(this).data('admin-id');
      Swal.fire({
        title: 'Are you sure?',
        text: "This will permanently delete the admin.",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Yes, delete it!'
      }).then((result) => {
        if (result.isConfirmed) {
          $.ajax({
            url: 'delete_admin.php',
            type: 'POST',
            data: { admin_ID: adminId },
            dataType: 'json',
            success: function (res) {
              $('#adminTable').DataTable().ajax.reload();
              Swal.fire({
                icon: res.success ? 'success' : 'error',
                title: res.success ? 'Deleted!' : 'Error',
                text: res.message,
                timer: 1500,
                showConfirmButton: false
              });
            }
          });
        }
      });
    });


    $('#loginTable').DataTable({
      ajax: 'fetch_Login.php',
      columns: [
        { data: 'login_ID' },
        { data: 'user_ID' },
        { data: 'emailAddress' },
        { data: 'userRole' },
        { data: 'loginTime' }
      ]
    });
    // Optionally reload table after form submission
    $('#addAdminForm').on('submit', function (e) {
      e.preventDefault();
      $.ajax({
        url: 'add_admin.php',
        type: 'POST',
        data: $(this).serialize(),
        dataType: 'json',
        success: function (res) {
          $('#addAdminModal').modal('hide');
          $('#addAdminForm')[0].reset();
          $('#adminTable').DataTable().ajax.reload();
          Swal.fire({
            icon: res.success ? 'success' : 'error',
            title: res.success ? 'Success' : 'Error',
            text: res.message,
            timer: 1500,
            showConfirmButton: false
          });
        }
      });
    });

    // for products 

    // Datatables Products
    new DataTable('#productTable', {
      responsive: true,
      scrollX: true,
      paging: true
    });


    // product message
    $('#productForm').on('submit', function (e) {
      e.preventDefault();

      let formData = new FormData(this);

      $.ajax({
        url: 'add_product.php',
        method: 'POST',
        data: formData,
        contentType: false,
        processData: false,
        dataType: 'json',
        success: function (res) {
          $('#productModal').modal('hide');
          $('#productModal').one('hidden.bs.modal', function () {
            $('#productForm')[0].reset();
            // Remove any lingering modal-backdrop and modal-open class
            $('.modal-backdrop').remove();
            $('body').removeClass('modal-open');
            Swal.fire({
              icon: res.success ? 'success' : 'error',
              title: res.success ? 'Success' : 'Error',
              text: res.message,
              showConfirmButton: false,
              timer: 1500
            }).then(() => {
              location.reload();
            });
          });
        },
        error: function () {
          $('#productModal').modal('hide');
          $('#productModal').one('hidden.bs.modal', function () {
            $('.modal-backdrop').remove();
            $('body').removeClass('modal-open');
            Swal.fire({
              icon: 'error',
              title: 'Error',
              text: 'An error occurred. Please try again.',
              showConfirmButton: false,
              timer: 1500
            }).then(() => {
              location.reload();
            });
          });
        }
      });
    });



    // 1. When clicking the update button, fetch product data and show modal
    $(document).on('click', '.updateBtn', function () {
      let productId = $(this).data('id');
      $.ajax({
        url: 'update_product.php',
        type: 'POST',
        data: { product_ID: productId },
        dataType: 'json',
        success: function (data) {
          $('#edit_product_ID').val(data.product_ID);
          $('#edit_productCategory').val(data.productCategory);
          $('#edit_productName').val(data.productName);
          $('#edit_productDescription').val(data.productDescription);
          $('#edit_productPrice').val(data.productPrice);
          $('#edit_productStock').val(data.productStock);
          $('#updateModal').modal('show');
        }
      });
    });

    // 2. When submitting the update form, send data via AJAX
    $('#updateForm').on('submit', function (e) {
      e.preventDefault();
      var formData = new FormData(this);
      formData.append('update_product', true);

      $.ajax({
        url: 'update_product.php',
        type: 'POST',
        data: formData,
        contentType: false,
        processData: false,
        dataType: 'json',
        success: function (response) {
          $('#updateModal').modal('hide');
          if (response.success) {
            Swal.fire({
              icon: 'success',
              title: 'Success',
              text: 'Product updated successfully!',
              showConfirmButton: false,
              timer: 1500
            }).then(() => {
              location.reload();
            });
          } else {
            Swal.fire({
              icon: 'error',
              title: 'Error',
              text: response.error || 'Update failed.'
            });
          }
        },
        error: function () {
          $('#updateModal').modal('hide');
          Swal.fire({
            icon: 'error',
            title: 'Error',
            text: 'An error occurred.'
          });
        }
      });
    });



    $(document).on('click', '.deleteBtn', function () {
      let productId = $(this).data('id');
      Swal.fire({
        title: 'Are you sure?',
        text: "You won't be able to revert this!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Yes, delete it!'
      }).then((result) => {
        if (result.isConfirmed) {
          $.ajax({
            url: 'delete_product.php',
            type: 'POST',
            data: { product_ID: productId },
            success: function (response) {
              Swal.fire({
                icon: 'success',
                title: 'Deleted!',
                text: 'Product deleted successfully!',
                showConfirmButton: false,
                timer: 1500
              }).then(() => {
                location.reload();
              });
            },
            error: function () {
              Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'An error occurred while deleting.'
              });
            }
          });
        }
      });
    });



    // for variation

    var table = $('#variationTable').DataTable({
      ajax: {
        url: 'list_variations.php',
        dataSrc: 'data'
      },
      columns: [
        { data: 'product_ID' },
        { data: 'variation_Name' },
        {
          data: 'product_Image',
          render: function (data) {
            return data ? `<img src="${data}" style="max-width:60px;">` : '';
          }
        },
        { data: 'dateCreated' },
        { data: 'dateUpdated' },
        {
          data: null,
          orderable: false,
          render: function (data, type, row) {
            return `
          <button class="btn btn-success btn-sm updateVariationBtn" data-id="${row.productVariation_ID}">Update</button>
          <button class="btn btn-danger btn-sm deleteVariationBtn" data-id="${row.productVariation_ID}">Delete</button>
        `;
          }
        }
      ]
    });


    $('#variationForm').on('submit', function (e) {
      e.preventDefault();
      var formData = new FormData(this);
      $.ajax({
        url: 'add_variation.php',
        type: 'POST',
        data: formData,
        contentType: false,
        processData: false,
        dataType: 'json',
        success: function (res) {
          $('#variationModal').modal('hide');
          $('#variationForm')[0].reset();
          table.ajax.reload();
          Swal.fire({
            icon: res.success ? 'success' : 'error',
            title: res.success ? 'Success' : 'Error',
            text: res.message,
            timer: 1500,
            showConfirmButton: false
          });
        }
      });
    });



    // Update Variation
    $('#variationTable').on('click', '.updateVariationBtn', function () {
      var id = $(this).data('id');
      $.ajax({
        url: 'get_variation.php',
        type: 'POST',
        data: { productVariation_ID: id },
        dataType: 'json',
        success: function (data) {
          $('#edit_productVariation_ID').val(data.productVariation_ID);
          $('#edit_variation_Name').val(data.variation_Name);
          $('#updateVariationModal').modal('show');
        }
      });
    });

    $('#updateVariationForm').on('submit', function (e) {
      e.preventDefault();
      var formData = new FormData(this);
      $.ajax({
        url: 'update_variation.php',
        type: 'POST',
        data: formData,
        contentType: false,
        processData: false,
        dataType: 'json',
        success: function (res) {
          $('#updateVariationModal').modal('hide');
          $('#updateVariationForm')[0].reset();
          table.ajax.reload();
          Swal.fire({
            icon: res.success ? 'success' : 'error',
            title: res.success ? 'Success' : 'Error',
            text: res.message,
            timer: 1500,
            showConfirmButton: false
          });
        }
      });
    });

    // Delete Variation
    $('#variationTable').on('click', '.deleteVariationBtn', function () {
      var id = $(this).data('id');
      Swal.fire({
        title: 'Are you sure?',
        text: "This will permanently delete the variation.",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Yes, delete it!'
      }).then((result) => {
        if (result.isConfirmed) {
          $.ajax({
            url: 'delete_variation.php',
            type: 'POST',
            data: { productVariation_ID: id },
            dataType: 'json',
            success: function (res) {
              table.ajax.reload();
              Swal.fire({
                icon: res.success ? 'success' : 'error',
                title: res.success ? 'Deleted!' : 'Error',
                text: res.message,
                timer: 1500,
                showConfirmButton: false
              });
            }
          });
        }
      });
    });


    // for product option
    var optionTable = $('#optionTable').DataTable({
      ajax: {
        url: 'list_options.php',
        dataSrc: 'data'
      },
      columns: [
        { data: 'option_ID' },
        {
          data: null,
          render: function (data, type, row) {
            return row.productVariation_ID + ' - ' + (row.variation_Name || '');
          }
        },
        { data: 'productOption' },
        { data: 'productStock' },
        { data: 'productPrice' },
        { data: 'dateCreated' },
        { data: 'dateUpdated' },
        {
          data: null,
          orderable: false,
          render: function (data, type, row) {
            return `
          <button class="btn btn-success btn-sm updateOptionBtn" data-id="${row.option_ID}">Update</button>
          <button class="btn btn-danger btn-sm deleteOptionBtn" data-id="${row.option_ID}">Delete</button>
        `;
          }
        }
      ]
    });
    // Add Option
    $('#optionForm').on('submit', function (e) {
      e.preventDefault();
      var formData = $(this).serialize();
      $.ajax({
        url: 'add_option.php',
        type: 'POST',
        data: formData,
        dataType: 'json',
        success: function (res) {
          $('#optionModal').modal('hide');
          $('#optionForm')[0].reset();
          optionTable.ajax.reload(); // Refresh the DataTable
          Swal.fire({
            icon: res.success ? 'success' : 'error',
            title: res.success ? 'Success' : 'Error',
            text: res.message,
            timer: 1500,
            showConfirmButton: false
          });
        }
      });
    });

    // show update modal
    $('#optionTable').on('click', '.updateOptionBtn', function () {
      var id = $(this).data('id');
      $.ajax({
        url: 'get_option.php',
        type: 'POST',
        data: { option_ID: id },
        dataType: 'json',
        success: function (data) {
          $('#edit_option_ID').val(data.option_ID);
          $('#edit_productOption').val(data.productOption);
          $('#edit_productStock').val(data.productStock);
          $('#edit_productPrice').val(data.productPrice);
          $('#updateOptionModal').modal('show');
        }
      });
    });

    // update message option
    $('#updateOptionForm').on('submit', function (e) {
      e.preventDefault();
      var formData = $(this).serialize();
      $.ajax({
        url: 'update_option.php',
        type: 'POST',
        data: formData,
        dataType: 'json',
        success: function (res) {
          $('#updateOptionModal').modal('hide');
          $('#updateOptionForm')[0].reset();
          optionTable.ajax.reload();
          Swal.fire({
            icon: res.success ? 'success' : 'error',
            title: res.success ? 'Success' : 'Error',
            text: res.message,
            timer: 1500,
            showConfirmButton: false
          });
        }
      });
    });

    // delete message option
    $('#optionTable').on('click', '.deleteOptionBtn', function () {
      var id = $(this).data('id');
      Swal.fire({
        title: 'Are you sure?',
        text: "This will permanently delete the option.",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Yes, delete it!'
      }).then((result) => {
        if (result.isConfirmed) {
          $.ajax({
            url: 'delete_option.php',
            type: 'POST',
            data: { option_ID: id },
            dataType: 'json',
            success: function (res) {
              optionTable.ajax.reload();
              Swal.fire({
                icon: res.success ? 'success' : 'error',
                title: res.success ? 'Deleted!' : 'Error',
                text: res.message,
                timer: 1500,
                showConfirmButton: false
              });
            }
          });
        }
      });
    });
  </script>
</body>

</html>